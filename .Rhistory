y = "Mutation rates (strong mutation)"
) +
theme_minimal()
rescue_results <- data.frame(
s_wm = numeric(),
m_rate_wm = numeric(),
replicate = integer(),
rescued_wd = integer(),
rescued_wb = integer()
)
total_runs <- 0
rescue_count <- 0
# --- Simulation loop ---
for (mval_wm in m_values_wm) {
for (sval_wm in s_values_wm) {
for (rep in 1:no_replicates) {
# Run your simulation (make sure simulate_pop() is defined)
one_run <- simulate_pop(
init_wd, init_wb, init_sd, init_sb,
decay_rate_wm, decay_rate_sm,
sval_wm, s_sm, mval_wm, m_rate_sm, max_gen
)
# Extract final population sizes correctly
pop <- one_run$population
N_end_wd <- tail(pop[, "wd"], 1)
N_end_wb <- tail(pop[, "wb"], 1)
# Determine rescue outcomes
rescued_wd <- as.integer(N_end_wd > 0)
rescued_wb <- as.integer(N_end_wb > 0)
# Append results
rescue_results <- rbind(
rescue_results,
data.frame(
s_wm = sval_wm,
m_rate_wm = mval_wm,
replicate = rep,
rescued_wd = rescued_wd,
rescued_wb = rescued_wb
)
)
}
}
}
# --- Summarise rescue probabilities ---
library(dplyr)
rescue_summary <- rescue_results %>%
group_by(s_wm, m_rate_wm) %>%
summarise(
rescue_prob_wd = mean(rescued_wd),
rescue_prob_wb = mean(rescued_wb),
.groups = "drop"
)
# --- Visualisation ---
library(tidyr)
library(ggplot2)
# Convert to long format (optional)
rescue_long <- rescue_summary %>%
pivot_longer(
cols = starts_with("rescue_prob_"),
names_to = "mutant",
values_to = "rescue_prob"
) %>%
mutate(mutant = gsub("rescue_prob_", "", mutant))
# --- Heatmap: weak deleterious mutation ---
ggplot(rescue_summary, aes(x = factor(s_wm), y = factor(m_rate_wm), fill = rescue_prob_wd)) +
geom_tile() +
scale_fill_gradientn(
colors = c("blue", "#FFB3B3", "red"),
values = c(0, 0.2, 1),
limits = c(0, 1),
name = "Rescue Prob wd"
) +
labs(
title = "Heatmap: Rescue Probability of Weak Deleterious Mutation",
x = "Weak selection coefficients",
y = "Mutation rates (weak mutation)"
) +
theme_minimal()
# --- Heatmap: weak beneficial mutation ---
ggplot(rescue_summary, aes(x = factor(s_wm), y = factor(m_rate_wm), fill = rescue_prob_wb)) +
geom_tile() +
scale_fill_gradientn(
colors = c("blue", "#FFB3B3", "red"),
values = c(0, 0.3, 1),
limits = c(0, 1),
name = "Rescue Prob wb"
) +
labs(
title = "Heatmap: Rescue Probability of Weak Beneficial Mutation",
x = "Weak selection coefficients",
y = "Mutation rates (weak mutation)"
) +
theme_minimal()
# --- Initial parameters ---
init_wd <- 30
init_wb <- 30
init_sd <- 30
init_sb <- 30
decay_rate_wm <- 0.15
decay_rate_sm <- 0.25
s_wm <- 0.2
s_sm <- 0.3
max_gen <- 1000
no_replicates <- 50
# --- Parameter grids ---
s_values_wm <- c(0.10, 0.15, 0.20)
s_values_sm <- c(0.25, 0.30, 0.35)
m_values_wm <- c(0.002, 0.004, 0.006)
m_values_sm <- c(0.006, 0.008, 0.010)
# --- Initialize results containers ---
data_table <- c()
data_table_wd <- c()
data_table_wb <- c()
data_table_sd <- c()
data_table_sb <- c()
rescue_results <- data.frame(
s_sm = numeric(),
m_rate_sm = numeric(),
replicate = integer(),
rescued_sd = integer(),
rescued_sb = integer()
)
# --- Counters ---
total_runs <- 0
rescue_count <- 0
# --- Simulation loop ---
for (mval_sm in m_values_sm) {
for (sval_sm in s_values_sm) {
for (rep in 1:no_replicates) {
# Run your simulation (make sure simulate_pop() is defined)
one_run <- simulate_pop(
init_wd, init_wb, init_sd, init_sb,
decay_rate_wm, decay_rate_sm,
sval_sm, s_wm, mval_sm, m_rate_wm, max_gen
)
# Extract final population sizes correctly
pop <- one_run$population
N_end_sd <- tail(pop[, "sd"], 1)
N_end_sb <- tail(pop[, "sb"], 1)
# Determine rescue outcomes
rescued_sd <- as.integer(N_end_sd > 0)
rescued_sb <- as.integer(N_end_sb > 0)
# Append results
rescue_results <- rbind(
rescue_results,
data.frame(
s_sm = sval_sm,
m_rate_sm = mval_sm,
replicate = rep,
rescued_sd = rescued_sd,
rescued_sb = rescued_sb
)
)
}
}
}
# --- Summarise rescue probabilities ---
library(dplyr)
rescue_summary <- rescue_results %>%
group_by(s_sm, m_rate_sm) %>%
summarise(
rescue_prob_sd = mean(rescued_sd),
rescue_prob_sb = mean(rescued_sb),
.groups = "drop"
)
# --- Visualisation ---
library(tidyr)
library(ggplot2)
# Long format (optional, for general plotting)
rescue_long <- rescue_summary %>%
pivot_longer(
cols = starts_with("rescue_prob_"),
names_to = "mutant",
values_to = "rescue_prob"
) %>%
mutate(mutant = gsub("rescue_prob_", "", mutant))
# --- Heatmap: strong deleterious mutation ---
ggplot(rescue_summary, aes(x = factor(s_sm), y = factor(m_rate_sm), fill = rescue_prob_sd)) +
geom_tile() +
scale_fill_gradientn(
colors = c("blue", "#FFB3B3", "red"),
values = c(0, 0.3, 1),
limits = c(0, 1),
name = "Rescue Prob sd"
) +
labs(
title = "Heatmap: Rescue Probability of Strong Deleterious Mutation",
x = "Strong selection coefficients",
y = "Mutation rates (strong mutation)"
) +
theme_minimal()
# --- Heatmap: strong beneficial mutation ---
ggplot(rescue_summary, aes(x = factor(s_sm), y = factor(m_rate_sm), fill = rescue_prob_sb)) +
geom_tile() +
scale_fill_gradientn(
colors = c("blue", "#FFB3B3", "red"),
values = c(0, 0.3, 1),
limits = c(0, 1),
name = "Rescue Prob sb"
) +
labs(
title = "Heatmap: Rescue Probability of Strong Beneficial Mutation",
x = "Strong selection coefficients",
y = "Mutation rates (strong mutation)"
) +
theme_minimal()
rescue_results <- data.frame(
s_wm = numeric(),
m_rate_wm = numeric(),
replicate = integer(),
rescued_wd = integer(),
rescued_wb = integer()
)
total_runs <- 0
rescue_count <- 0
# --- Simulation loop ---
for (mval_wm in m_values_wm) {
for (sval_wm in s_values_wm) {
for (rep in 1:no_replicates) {
# Run your simulation (make sure simulate_pop() is defined)
one_run <- simulate_pop(
init_wd, init_wb, init_sd, init_sb,
decay_rate_wm, decay_rate_sm,
sval_wm, s_sm, mval_wm, m_rate_sm, max_gen
)
# Extract final population sizes correctly
pop <- one_run$population
N_end_wd <- tail(pop[, "wd"], 1)
N_end_wb <- tail(pop[, "wb"], 1)
# Determine rescue outcomes
rescued_wd <- as.integer(N_end_wd > 0)
rescued_wb <- as.integer(N_end_wb > 0)
# Append results
rescue_results <- rbind(
rescue_results,
data.frame(
s_wm = sval_wm,
m_rate_wm = mval_wm,
replicate = rep,
rescued_wd = rescued_wd,
rescued_wb = rescued_wb
)
)
}
}
}
# --- Summarise rescue probabilities ---
library(dplyr)
rescue_summary <- rescue_results %>%
group_by(s_wm, m_rate_wm) %>%
summarise(
rescue_prob_wd = mean(rescued_wd),
rescue_prob_wb = mean(rescued_wb),
.groups = "drop"
)
# --- Visualisation ---
library(tidyr)
library(ggplot2)
# Convert to long format (optional)
rescue_long <- rescue_summary %>%
pivot_longer(
cols = starts_with("rescue_prob_"),
names_to = "mutant",
values_to = "rescue_prob"
) %>%
mutate(mutant = gsub("rescue_prob_", "", mutant))
# --- Heatmap: weak deleterious mutation ---
ggplot(rescue_summary, aes(x = factor(s_wm), y = factor(m_rate_wm), fill = rescue_prob_wd)) +
geom_tile() +
scale_fill_gradientn(
colors = c("blue", "#FFB3B3", "red"),
values = c(0, 0.2, 1),
limits = c(0, 1),
name = "Rescue Prob wd"
) +
labs(
title = "Heatmap: Rescue Probability of Weak Deleterious Mutation",
x = "Weak selection coefficients",
y = "Mutation rates (weak mutation)"
) +
theme_minimal()
# --- Heatmap: weak beneficial mutation ---
ggplot(rescue_summary, aes(x = factor(s_wm), y = factor(m_rate_wm), fill = rescue_prob_wb)) +
geom_tile() +
scale_fill_gradientn(
colors = c("blue", "#FFB3B3", "red"),
values = c(0, 0.3, 1),
limits = c(0, 1),
name = "Rescue Prob wb"
) +
labs(
title = "Heatmap: Rescue Probability of Weak Beneficial Mutation",
x = "Weak selection coefficients",
y = "Mutation rates (weak mutation)"
) +
theme_minimal()
# --- Initial parameters ---
init_wd <- 30
init_wb <- 30
init_sd <- 30
init_sb <- 30
decay_rate_wm <- 0.15
decay_rate_sm <- 0.25
max_gen <- 1000
no_replicates <- 50
# --- Parameter grids ---
s_values_wm <- c(0.10, 0.15, 0.20)
s_values_sm <- c(0.25, 0.30, 0.35)
m_values_wm <- c(0.002, 0.004, 0.006)
m_values_sm <- c(0.006, 0.008, 0.010)
# --- Initialize results containers ---
data_table <- c()
data_table_wd <- c()
data_table_wb <- c()
data_table_sd <- c()
data_table_sb <- c()
rescue_results <- data.frame(
s_sm = numeric(),
m_rate_sm = numeric(),
replicate = integer(),
rescued_sd = integer(),
rescued_sb = integer()
)
# --- Counters ---
total_runs <- 0
rescue_count <- 0
# --- Simulation loop ---
for (mval_sm in m_values_sm) {
for (sval_sm in s_values_sm) {
for (rep in 1:no_replicates) {
# Run your simulation (make sure simulate_pop() is defined)
one_run <- simulate_pop(
init_wd, init_wb, init_sd, init_sb,
decay_rate_wm, decay_rate_sm,
sval_sm, s_wm, mval_sm, m_rate_wm, max_gen
)
# Extract final population sizes correctly
pop <- one_run$population
N_end_sd <- tail(pop[, "sd"], 1)
N_end_sb <- tail(pop[, "sb"], 1)
# Determine rescue outcomes
rescued_sd <- as.integer(N_end_sd > 0)
rescued_sb <- as.integer(N_end_sb > 0)
# Append results
rescue_results <- rbind(
rescue_results,
data.frame(
s_sm = sval_sm,
m_rate_sm = mval_sm,
replicate = rep,
rescued_sd = rescued_sd,
rescued_sb = rescued_sb
)
)
}
}
}
# --- Summarise rescue probabilities ---
library(dplyr)
rescue_summary <- rescue_results %>%
group_by(s_sm, m_rate_sm) %>%
summarise(
rescue_prob_sd = mean(rescued_sd),
rescue_prob_sb = mean(rescued_sb),
.groups = "drop"
)
# --- Visualisation ---
library(tidyr)
library(ggplot2)
# Long format (optional, for general plotting)
rescue_long <- rescue_summary %>%
pivot_longer(
cols = starts_with("rescue_prob_"),
names_to = "mutant",
values_to = "rescue_prob"
) %>%
mutate(mutant = gsub("rescue_prob_", "", mutant))
# --- Heatmap: strong deleterious mutation ---
ggplot(rescue_summary, aes(x = factor(s_sm), y = factor(m_rate_sm), fill = rescue_prob_sd)) +
geom_tile() +
scale_fill_gradientn(
colors = c("blue", "#FFB3B3", "red"),
values = c(0, 0.3, 1),
limits = c(0, 1),
name = "Rescue Prob sd"
) +
labs(
title = "Heatmap: Rescue Probability of Strong Deleterious Mutation",
x = "Strong selection coefficients",
y = "Mutation rates (strong mutation)"
) +
theme_minimal()
# --- Heatmap: strong beneficial mutation ---
ggplot(rescue_summary, aes(x = factor(s_sm), y = factor(m_rate_sm), fill = rescue_prob_sb)) +
geom_tile() +
scale_fill_gradientn(
colors = c("blue", "#FFB3B3", "red"),
values = c(0, 0.3, 1),
limits = c(0, 1),
name = "Rescue Prob sb"
) +
labs(
title = "Heatmap: Rescue Probability of Strong Beneficial Mutation",
x = "Strong selection coefficients",
y = "Mutation rates (strong mutation)"
) +
theme_minimal()
rescue_results <- data.frame(
s_wm = numeric(),
m_rate_wm = numeric(),
replicate = integer(),
rescued_wd = integer(),
rescued_wb = integer()
)
total_runs <- 0
rescue_count <- 0
# --- Simulation loop ---
for (mval_wm in m_values_wm) {
for (sval_wm in s_values_wm) {
for (rep in 1:no_replicates) {
# Run your simulation (make sure simulate_pop() is defined)
one_run <- simulate_pop(
init_wd, init_wb, init_sd, init_sb,
decay_rate_wm, decay_rate_sm,
sval_wm, s_sm, mval_wm, m_rate_sm, max_gen
)
# Extract final population sizes correctly
pop <- one_run$population
N_end_wd <- tail(pop[, "wd"], 1)
N_end_wb <- tail(pop[, "wb"], 1)
# Determine rescue outcomes
rescued_wd <- as.integer(N_end_wd > 0)
rescued_wb <- as.integer(N_end_wb > 0)
# Append results
rescue_results <- rbind(
rescue_results,
data.frame(
s_wm = sval_wm,
m_rate_wm = mval_wm,
replicate = rep,
rescued_wd = rescued_wd,
rescued_wb = rescued_wb
)
)
}
}
}
# --- Summarise rescue probabilities ---
library(dplyr)
rescue_summary <- rescue_results %>%
group_by(s_wm, m_rate_wm) %>%
summarise(
rescue_prob_wd = mean(rescued_wd),
rescue_prob_wb = mean(rescued_wb),
.groups = "drop"
)
# --- Visualisation ---
library(tidyr)
library(ggplot2)
# Convert to long format (optional)
rescue_long <- rescue_summary %>%
pivot_longer(
cols = starts_with("rescue_prob_"),
names_to = "mutant",
values_to = "rescue_prob"
) %>%
mutate(mutant = gsub("rescue_prob_", "", mutant))
# --- Heatmap: weak deleterious mutation ---
ggplot(rescue_summary, aes(x = factor(s_wm), y = factor(m_rate_wm), fill = rescue_prob_wd)) +
geom_tile() +
scale_fill_gradientn(
colors = c("blue", "#FFB3B3", "red"),
values = c(0, 0.2, 1),
limits = c(0, 1),
name = "Rescue Prob wd"
) +
labs(
title = "Heatmap: Rescue Probability of Weak Deleterious Mutation",
x = "Weak selection coefficients",
y = "Mutation rates (weak mutation)"
) +
theme_minimal()
# --- Heatmap: weak beneficial mutation ---
ggplot(rescue_summary, aes(x = factor(s_wm), y = factor(m_rate_wm), fill = rescue_prob_wb)) +
geom_tile() +
scale_fill_gradientn(
colors = c("blue", "#FFB3B3", "red"),
values = c(0, 0.3, 1),
limits = c(0, 1),
name = "Rescue Prob wb"
) +
labs(
title = "Heatmap: Rescue Probability of Weak Beneficial Mutation",
x = "Weak selection coefficients",
y = "Mutation rates (weak mutation)"
) +
theme_minimal()
# --- Heatmap: weak beneficial mutation ---
ggplot(rescue_summary, aes(x = factor(s_wm), y = factor(m_rate_wm), fill = rescue_prob_wb)) +
geom_tile() +
scale_fill_gradientn(
colors = c("blue", "#FFB3B3", "red"),
values = c(0, 0.3, 1),
limits = c(0, 1),
name = "Rescue Prob wb"
) +
labs(
title = "Heatmap: Rescue Probability of Weak Beneficial Mutation",
x = "Weak selection coefficients",
y = "Mutation rates (weak mutation)"
) +
theme_minimal()
